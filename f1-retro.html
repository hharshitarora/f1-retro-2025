<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>F1 2025: The Decider</title> <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"> 
        <style> :root { --bg-color: #1a1a2e; --panel-bg: #16213e; --text-color: #e94560; --white: #ffffff; --gold: #FFD700; }

    /* TEAM PALETTES */
    .ferrari { --c-body: #FF2800; --c-accent: #000; --c-rim: #FFEE00; }
    .mclaren { --c-body: #FF8000; --c-accent: #111; --c-rim: #000; }
    .redbull { --c-body: #0600EF; --c-accent: #FFD700; --c-rim: #FF0000; }
    .mercedes { --c-body: #C0C0C0; --c-accent: #00D2BE; --c-rim: #00D2BE; }
    .aston { --c-body: #006F62; --c-accent: #BED430; --c-rim: #BED430; }

    body {
        background-color: var(--bg-color);
        color: var(--white);
        font-family: 'Press Start 2P', cursive;
        margin: 0;
        padding: 20px;
        /* Retro background pattern */
        background-image:
            linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        background-size: 20px 20px;
    }

    .container { max-width: 1000px; margin: 0 auto; }
    h1 { text-align: center; color: var(--text-color); margin-bottom: 40px; text-shadow: 4px 4px #000; }

    /* --- SCOREBOARD --- */
    .scoreboard {
        background: #000;
        border: 4px solid var(--white);
        padding: 20px;
        margin-bottom: 40px;
        box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
        transition: all 0.3s ease;
    }
    .score-row {
        display: flex; justify-content: space-between; padding: 10px 0;
        border-bottom: 2px dashed #333;
    }
    .score-row.leader { color: var(--gold); }
    .score-row:last-child { border: none; }

    /* --- CARD DESIGN --- */
    .contender-card {
        background: var(--panel-bg);
        border: 4px solid var(--c-body);
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        transition: transform 0.2s;
    }

    @media (max-width: 768px) {
        .contender-card { flex-direction: column; text-align: center; }
    }

    .driver-info { flex: 1; }
    .driver-name { font-size: 1.2rem; margin-bottom: 10px; text-shadow: 2px 2px #000; }
    .stats { font-size: 0.7rem; color: #aaa; }

    /* --- PIXEL ART CAR CSS --- */
    .car-stage {
        flex: 2;
        height: 80px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .pixel-f1 {
        position: relative;
        width: 160px;
        height: 50px;
        animation: idle 0.2s infinite steps(2);
    }

    @keyframes idle { 0% { transform: translateY(0); } 100% { transform: translateY(-2px); } }

    .wheel {
        position: absolute; bottom: 0; width: 32px; height: 32px;
        background: #111; border-radius: 5px;
        box-shadow: inset 0 0 0 2px #222, inset 0 0 0 8px #000;
        z-index: 10;
    }
    .wheel::after {
        content: ''; position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 12px; height: 12px;
        background: var(--c-rim); box-shadow: inset 0 0 0 2px #000;
    }
    .w-rear { left: 10px; }
    .w-front { right: 25px; }

    .floor {
        position: absolute; bottom: 5px; left: 20px; width: 120px; height: 8px;
        background: #000; z-index: 5;
    }

    .body-main {
        position: absolute; bottom: 13px; left: 35px; width: 70px; height: 14px;
        background: var(--c-body); z-index: 6;
    }
    .body-engine {
        position: absolute; bottom: 27px; left: 45px; width: 40px; height: 10px;
        background: var(--c-body); z-index: 6;
        background: linear-gradient(90deg, var(--c-body) 70%, transparent 70%);
    }
    .body-nose {
        position: absolute; bottom: 13px; right: 35px; width: 40px; height: 8px;
        background: var(--c-body); z-index: 6;
        clip-path: polygon(0 0, 100% 40%, 100% 100%, 0% 100%);
    }

    .wing-rear {
        position: absolute; bottom: 30px; left: 5px; width: 25px; height: 12px;
        background: #000; border-top: 4px solid var(--c-body); z-index: 8;
    }
    .wing-front {
        position: absolute; bottom: 8px; right: 15px; width: 25px; height: 6px;
        background: var(--c-body); z-index: 8;
    }

    .cockpit {
        position: absolute; bottom: 25px; left: 70px; width: 20px; height: 10px;
        background: #222; z-index: 5;
    }
    .halo {
        position: absolute; bottom: 30px; left: 75px; width: 25px; height: 2px;
        background: var(--c-body); z-index: 9;
    }
    .driver-helmet {
        position: absolute; bottom: 28px; left: 72px; width: 8px; height: 8px;
        background: #fff; border-radius: 2px; z-index: 7;
    }

    /* --- SLIDERS --- */
    .controls { flex: 1; min-width: 200px; }
    .slider-label { font-size: 0.6rem; margin-bottom: 5px; text-align: right; }
    input[type=range] { width: 100%; cursor: pointer; accent-color: var(--text-color); }

</style>

</head> <body>

<div class="container">
    <h1>F1 2025: FINALE</h1>

    <div class="scoreboard" id="scoreboard">
        <!-- JS Injected -->
    </div>

    <div id="drivers-container">
        <!-- JS Injected -->
    </div>
</div>

<script>
    // --- DATA ---
    const drivers = [
        { id: "nor", name: "Lando Norris", team: "McLaren", class: "mclaren", points: 408 },
        { id: "ver", name: "Max Verstappen", team: "Red Bull", class: "redbull", points: 396 },
        { id: "pia", name: "Oscar Piastri", team: "McLaren", class: "mclaren", points: 392 },
        { id: "rus", name: "George Russell", team: "Mercedes", class: "mercedes", points: 309 },
        { id: "lec", name: "Charles Leclerc", team: "Ferrari", class: "ferrari", points: 230 }
    ];

    const pointsMap = {
        1: 25, 2: 18, 3: 15, 4: 12, 5: 10,
        6: 8, 7: 6, 8: 4, 9: 2, 10: 1
    };

    // Initialize State: Everyone at DNF (21)
    let simState = {};
    drivers.forEach(d => simState[d.id] = 21);

    const container = document.getElementById('drivers-container');
    const scoreboard = document.getElementById('scoreboard');

    // --- RENDER ---
    drivers.forEach(d => {
        const card = document.createElement('div');
        card.className = `contender-card ${d.class}`;
        card.innerHTML = `
            <div class="driver-info">
                <div class="driver-name">${d.name}</div>
                <div class="stats">Start: ${d.points} PTS</div>
            </div>
            <div class="car-stage">
                <div class="pixel-f1">
                    <div class="wing-rear"></div>
                    <div class="floor"></div>
                    <div class="body-main"></div>
                    <div class="body-engine"></div>
                    <div class="body-nose"></div>
                    <div class="cockpit"></div>
                    <div class="driver-helmet"></div>
                    <div class="halo"></div>
                    <div class="wing-front"></div>
                    <div class="wheel w-rear"></div>
                    <div class="wheel w-front"></div>
                </div>
            </div>
            <div class="controls">
                <div class="slider-label" id="lbl-${d.id}">FINISH: DNF</div>
                <!-- Added ID to input for conflict resolution -->
                <input type="range" id="input-${d.id}" min="1" max="21" value="21"
                       oninput="handleInput('${d.id}', this.value)">
            </div>
        `;
        container.appendChild(card);
    });

    // --- CORE LOGIC ---

    function handleInput(driverId, newValueStr) {
        const newValue = parseInt(newValueStr);
        const oldValue = simState[driverId];

        // 1. Update the moving driver immediately
        simState[driverId] = newValue;
        updateLabel(driverId, newValue);

        // 2. Conflict Detection (Only if not DNF/P21)
        if (newValue < 21) {
            // Find if any OTHER driver currently holds this position
            const conflictDriver = drivers.find(d =>
                d.id !== driverId && simState[d.id] === newValue
            );

            if (conflictDriver) {
                // 3. Resolve Conflict: Swap the other driver to the OLD position
                // If the old position was DNF (21), the other driver becomes DNF
                // If the old position was P2 (and we moved to P1), they become P2

                const swapTarget = oldValue;
                simState[conflictDriver.id] = swapTarget;

                // Update DOM for the swapped driver
                const conflictInput = document.getElementById(`input-${conflictDriver.id}`);
                if(conflictInput) conflictInput.value = swapTarget;

                updateLabel(conflictDriver.id, swapTarget);
            }
        }

        // 4. Update Scoreboard
        updateScoreboard();
    }

    function updateLabel(id, val) {
        const lbl = document.getElementById(`lbl-${id}`);
        if(val > 20) {
            lbl.innerText = "FINISH: DNF";
        } else {
            const pts = pointsMap[val] || 0;
            lbl.innerText = `FINISH: P${val} (+${pts})`;
        }
    }

    function updateScoreboard() {
        const standings = drivers.map(d => {
            const racePts = pointsMap[simState[d.id]] || 0;
            return {
                name: d.name,
                total: d.points + racePts,
                diff: racePts
            };
        });

        standings.sort((a, b) => b.total - a.total);

        scoreboard.innerHTML = `<div style="text-align:center; margin-bottom:15px; font-size:0.6rem; color:#aaa;">LIVE CHAMPIONSHIP STANDINGS</div>`;
        standings.forEach((d, index) => {
            const row = document.createElement('div');
            row.className = `score-row ${index === 0 ? 'leader' : ''}`;
            const diffTxt = d.diff > 0 ? `(+${d.diff})` : '';
            row.innerHTML = `
                <div>${index + 1}. ${d.name}</div>
                <div>${d.total} PTS <span style="font-size:0.6rem; color:#aaa">${diffTxt}</span></div>
            `;
            scoreboard.appendChild(row);
        });
    }

    // Init
    updateScoreboard();

</script>
</body> 
</html>